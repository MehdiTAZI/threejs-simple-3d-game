<!DOCTYPE html>
  <!--
  TODO :
    Organize code
    Add Physics and sound engines
    Add textures and 3D Objects
  -->
  <html>
    <head>
      <title>Breaker Game</title>
      <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/build/three.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/examples/js/loaders/GLTFLoader.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/examples/js/loaders/RGBELoader.js"></script>
      <!--
      <script src="https://cdn.jsdelivr.net/npm/cannon@0.7.0/build/cannon.min.js"></script>
      -->
      <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAnUlEQVQ4T+WSwQ2DMBBFX1AEUpAEtKAP0KAHpYAO0KAHxwW3cym1iS3mZ93zz2cCcGwhCE2AGHcAiLkj4M9zQQux3ApsAHuABWkK8pPAJuK9aygJ6a1AFGx6SkgKiNR/xicqqLdJd1p1An0So2S1xgEtPYpMyg7MqNjD30tjNPkXvu5Bkrfbpv25CZVw4lIw5ruDc6gX2o37C6GQWJymSxhZ1aAAAAAElFTkSuQmCC" />
      <style>
        body {
          margin: 0;
          font-family: Arial, Helvetica, sans-serif;
          background: radial-gradient(circle at 30% 20%, #1f2937, #0f172a 55%, #020617 100%);
          color: #fff;
        }
        body::before {
          content: "";
          position: fixed;
          inset: 0;
          background: url('https://media.giphy.com/media/26AHONQ79FdWZhAI0/giphy.gif') center/cover no-repeat fixed;
          opacity: 0.2;
          mix-blend-mode: screen;
          pointer-events: none;
          z-index: -2;
          animation: bgFade 24s ease-in-out infinite;
        }
        canvas { width: 100%; height: 100%; display: block; }
        /* HUD */
        #hud {
          position: absolute;
          left: 12px;
          top: 12px;
          color: #fff;
          z-index: 10;
          padding: 10px 14px;
          background: rgba(17, 24, 39, 0.6);
          border-radius: 10px;
          backdrop-filter: blur(4px);
          text-shadow: 0 0 6px rgba(0,0,0,0.7);
        }
        #hud .line { margin-bottom: 6px; }
        #hud .metric { display: flex; align-items: baseline; gap: 6px; }
        #hud .label { font-size: 13px; letter-spacing: .04em; text-transform: uppercase; opacity: 0.7; }
        #hud .value { font-weight: 700; color: #4ade80; }
        #hud .value.alert { color: #facc15; }
        #controls {
          position: absolute;
          right: 12px;
          top: 12px;
          color: #fff;
          z-index: 10;
          text-align: right;
        }
        #controls .btn-row { margin-top: 6px; }
        .level-grid { margin-top: 10px; }
        .level-card {
          background: rgba(30, 41, 59, 0.85);
          border: 1px solid transparent;
          border-radius: 14px;
          padding: 18px;
          text-align: left;
          color: inherit;
          cursor: pointer;
          transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .level-card .title { font-size: 19px; font-weight: 700; margin-bottom: 6px; }
        .level-card .subtitle { font-size: 13px; color: #93c5fd; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
        .level-card .description { font-size: 13px; color: #cbd5f5; margin-bottom: 10px; }
        .level-card .stats { font-size: 12px; color: #fbbf24; }
        .level-card:hover { transform: translateY(-3px); border-color: rgba(59, 130, 246, 0.68); box-shadow: 0 10px 24px rgba(30, 64, 175, 0.28); }
        .level-card.active { border-color: rgba(236, 72, 153, 0.8); box-shadow: 0 12px 28px rgba(236, 72, 153, 0.35); }
        #level-details { display: block; font-size: 13px; color: #cbd5f5; margin-right: 24px; }
        #selector-buttons {
          margin-top: 8px;
          display: flex;
          justify-content: flex-end;
          gap: 10px;
        }
        #selector-buttons button {
          background: rgba(129, 140, 248, 0.22);
          border: 1px solid rgba(129, 140, 248, 0.6);
          border-radius: 999px;
          padding: 7px 18px;
          color: #e0e7ff;
          font-size: 12px;
          cursor: pointer;
          transition: all 0.2s ease;
        }
        #selector-buttons button:hover { border-color: rgba(167, 139, 250, 0.9); color: #f5f3ff; }
        #paddle-open-btn {
          background: rgba(236, 72, 153, 0.18);
          border-color: rgba(244, 114, 182, 0.55);
          color: #ffe4f1;
        }
        #paddle-open-btn:hover { border-color: rgba(244, 114, 182, 0.85); color: #fff0f8; }
        #difficulty-info {
          margin-top: 6px;
          font-size: 11px;
          color: #cbd5f5;
          max-width: 260px;
          margin-left: auto;
        }
        #volume-control {
          margin-top: 10px;
          font-size: 12px;
          color: #bfdbfe;
        }
        #volume-control input[type="range"] {
          width: 160px;
          accent-color: #38bdf8;
        }
        #message {
          position: absolute;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          color: #fff;
          z-index: 11;
          font-size: 24px;
          background: rgba(0,0,0,0.5);
          padding: 12px 18px;
          border-radius: 8px;
          display: none;
        }
        #achievements { margin-top: 8px; font-size: 12px; color: #ffeb3b; }
        #scene-banner {
          position: absolute;
          left: 50%;
          top: 14px;
          transform: translateX(-50%);
          color: #e0f2fe;
          font-size: 18px;
          letter-spacing: 0.04em;
          text-transform: uppercase;
          padding: 6px 12px;
          border-radius: 20px;
          background: rgba(8, 47, 73, 0.65);
          box-shadow: 0 0 12px rgba(14, 165, 233, 0.35);
          z-index: 9;
          opacity: 0.6;
          transition: opacity 0.8s ease;
        }
        @keyframes bgFade {
          0% { opacity: 0.18; }
          50% { opacity: 0.28; }
          100% { opacity: 0.18; }
        }
        .modal {
          position: fixed;
          inset: 0;
          background: rgba(10, 11, 25, 0.86);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 30;
          transition: opacity 0.4s ease;
        }
        .modal.hidden { opacity: 0; pointer-events: none; }
        .modal-content {
          background: rgba(15, 23, 42, 0.92);
          border: 1px solid rgba(148, 163, 184, 0.3);
          border-radius: 18px;
          padding: 28px 32px;
          max-width: 760px;
          width: 90%;
          box-shadow: 0 20px 60px rgba(2, 6, 23, 0.55);
          color: #e2e8f0;
        }
        .modal-content h2 {
          margin: 0 0 18px;
          font-size: 26px;
          text-align: center;
          letter-spacing: .04em;
        }
        .paddle-grid {
          display: grid;
          gap: 16px;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          margin-bottom: 18px;
        }
        .paddle-card {
          background: rgba(30, 41, 59, 0.85);
          border: 1px solid transparent;
          border-radius: 14px;
          padding: 18px;
          text-align: left;
          color: inherit;
          cursor: pointer;
          transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .paddle-card .title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .paddle-card .stats { font-size: 14px; color: #cbd5f5; margin-bottom: 8px; }
        .paddle-card .ability { font-size: 13px; color: #facc15; }
        .paddle-card:hover { transform: translateY(-3px); border-color: rgba(59, 130, 246, 0.7); box-shadow: 0 10px 24px rgba(30, 64, 175, 0.32); }
        .paddle-card.active { border-color: rgba(244, 114, 182, 0.9); box-shadow: 0 10px 26px rgba(236, 72, 153, 0.35); }
        .modal-footer {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 8px;
          font-size: 13px;
          color: #cbd5f5;
        }
        #select-confirm,
        #level-confirm {
          background: linear-gradient(135deg, #6366f1, #8b5cf6);
          border: none;
          border-radius: 999px;
          padding: 10px 22px;
          color: #fff;
          font-weight: 600;
          cursor: pointer;
          transition: opacity 0.2s ease;
        }
        #select-confirm:disabled,
        #level-confirm:disabled { opacity: 0.45; cursor: not-allowed; }
      </style>
    </head>
    <body>
      <canvas id="game-canvas"></canvas>

      <div id="hud">
        <div class="line metric"><span class="label">Score</span><span class="value" id="score">0</span></div>
        <div class="line metric"><span class="label">Best</span><span class="value" id="best-score">0</span></div>
        <div class="line metric"><span class="label">Combo</span><span class="value" id="combo">x1</span></div>
        <div class="line metric"><span class="label">Lives</span><span class="value" id="lives">3</span></div>
        <div class="line metric"><span class="label">Level</span><span class="value" id="level">1</span></div>
        <div class="line metric"><span class="label">Ability</span><span class="value" id="ability-status">—</span></div>
        <div class="line" style="margin-top:8px;font-size:12px;color:#bae6fd;">
          Quest: <span id="quest">—</span>
        </div>
        <div id="achievements">Achievements: <span id="ach-list">—</span></div>
      </div>

      <div id="scene-banner">Init</div>

      <div id="controls">
        <div>Controls: arrows / mouse - Magic: press F</div>
        <div class="btn-row"><button id="start-btn">Start</button> <button id="pause-btn">Pause</button> <button id="restart-btn">Restart</button> <button id="audio-btn">Audio: on</button></div>
        <div id="selector-buttons">
          <button id="level-open-btn">Select Level</button>
          <button id="paddle-open-btn">Select Paddle</button>
        </div>
        <div id="difficulty-info"></div>
        <div id="volume-control">Volume: <input id="volume-range" type="range" min="0" max="100" value="80" /></div>
      </div>

      <div id="message"></div>

      <div id="paddle-select" class="modal">
        <div class="modal-content">
          <h2>Choose your paddle</h2>
          <div class="paddle-grid">
            <button class="paddle-card" data-key="titan">
              <div class="title">Crimson Titan</div>
              <div class="stats">Wide reach - Heavy control</div>
              <div class="ability">Ability: Inferno strike — fiery ball burns nearby bricks</div>
            </button>
            <button class="paddle-card" data-key="aero">
              <div class="title">Azure Aero</div>
              <div class="stats">Ultra fast - Slim profile</div>
              <div class="ability">Ability: Ice barrier — conjures a rebound wall</div>
            </button>
            <button class="paddle-card" data-key="mystic">
              <div class="title">Violet Mystic</div>
              <div class="stats">Balanced - Precise control</div>
              <div class="ability">Ability: Time slow</div>
            </button>
          </div>
          <div class="modal-footer">
            <span id="paddle-details">Select a paddle to inspect its stats.</span>
            <button id="select-confirm" disabled>Confirm</button>
          </div>
        </div>
      </div>

      <div id="level-select-modal" class="modal hidden">
        <div class="modal-content">
          <h2>Select your mission</h2>
          <div class="paddle-grid level-grid">
            <button class="level-card active" data-key="nebula">
              <div class="title">Nebula Run</div>
              <div class="subtitle">Easy - Stage 1</div>
              <div class="description">Gentle ball speed and extra lives make it perfect for warm-ups.</div>
              <div class="stats">Music: Synthwave Nebula</div>
            </button>
            <button class="level-card" data-key="garden">
              <div class="title">Cosmic Bloom</div>
              <div class="subtitle">Normal - Stage 2</div>
              <div class="description">Balanced pace with the original challenge curve and rewards.</div>
              <div class="stats">Music: Cosmic Garden</div>
            </button>
            <button class="level-card" data-key="station">
              <div class="title">Orbital Siege</div>
              <div class="subtitle">Hard - Stage 3</div>
              <div class="description">Less margin for error, faster rebounds, and denser brick waves.</div>
              <div class="stats">Music: Orbital Station</div>
            </button>
            <button class="level-card" data-key="aurora">
              <div class="title">Aurora Peaks</div>
              <div class="subtitle">Chill - Stage 4</div>
              <div class="description">Icy cliffs with reflective snow banks and drifting platforms.</div>
              <div class="stats">Music: Aurora Peaks</div>
            </button>
            <button class="level-card" data-key="mirage">
              <div class="title">Desert Mirage</div>
              <div class="subtitle">Arid - Stage 5</div>
              <div class="description">Shimmering dunes, swirling sands, and mirage-triggered gusts.</div>
              <div class="stats">Music: Desert Mirage</div>
            </button>
            <button class="level-card" data-key="neon">
              <div class="title">Neon Shards</div>
              <div class="subtitle">Night - Stage 6</div>
              <div class="description">Hyper-speed neon rails, split lanes, and relentless combos.</div>
              <div class="stats">Music: Neon Shards</div>
            </button>
          </div>
          <div class="modal-footer">
            <span id="level-details">Nebula Run — Gentle ball speed and extra lives make it perfect for warm-ups.</span>
            <button id="level-confirm">Confirm</button>
          </div>
        </div>
      </div>

      <script type="module" src="./src/main.js"></script>
    </body>
  </html>
